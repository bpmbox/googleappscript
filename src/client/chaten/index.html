<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Chat Widget</title>
	<script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-database.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
	<script src="https://unpkg.com/vue"></script>
	<link rel="stylesheet"
		href="https://dhtmlx.com/docs/products/visualDesigner/live/preview/codebase/dhtmlxscheduler.css" type="text/css"
		charset="utf-8">
	<link rel="stylesheet"
		href="https://dhtmlx.com/docs/products/visualDesigner/live/preview/codebase/preview_skyblue.css" type="text/css"
		charset="utf-8">
	<link rel="stylesheet"
		href="https://dhtmlx.com/docs/products/visualDesigner/live/preview/codebase/preview_terrace.css" type="text/css"
		charset="utf-8">
	<link rel="stylesheet" href="https://dhtmlx.com/docs/products/visualDesigner/live/preview/codebase/preview_web.css"
		type="text/css" charset="utf-8">

	<script src="https://dhtmlx.com/docs/products/visualDesigner/live/preview/codebase/preview.js"
		type="text/javascript" charset="utf-8"></script>
	<script src="https://dhtmlx.com/docs/products/visualDesigner/live/preview/codebase/dhtmlxscheduler.js"
		type="text/javascript" charset="utf-8"></script>
	<script language="JavaScript"
		src="https://dhtmlx.com/docs/products/visualDesigner/live/preview/codebase/swfobject.js"
		type="text/javascript"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<script src="https://code.jquery.com/jquery-3.2.1.js"
		integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>

</head>

<body>



	<!--
         <textarea id="message-input_junle" placeholder="Message..." value=""></textarea>
          function showStatus(msg, classId) {
    $('#sidebar-status').removeClass().html(msg);
    if (classId) {
      $('#sidebar-status').addClass(classId);
    }
  }

         /-->


	<!--
        <div class="phone-canvas">
            <div class="info-panel">
            <div class="info-title">

                <h2> <a target="_new" href="https://www.bpmchat.com">BPMCHAT</a></h2>
                <h1>BPMBOXES</h1>
                <h2> <a target="_new" href="https://www.bpmboxes.com/">BPMBOXES</a></h2>
 <div id="sidebar-status"></div>
            </div>
        </div>/-->

	<div class="chat-ui-canvas" id="chatobj">
		<div id="header" class="header header-scrolled">
			<div class="top-icons">
				<div class="back-arrow">
					<div class="back-arrow-line back-arrow-line-1"></div>
					<div class="back-arrow-line back-arrow-line-2"></div>
					<div class="back-arrow-line back-arrow-line-3"></div>
				</div>
				<div class="phone-icon">
					<img src="https://i.imgur.com/4OTkocV.png" height="50%">
				</div>
			</div>
			<div class="user-header-image"></div>
			<div class="user-name-header">
				<h1>Kenichi miyata</h1>
			</div>
		</div>
		<div id="message-feed" class="message-feed message-feed-unscrolled">
			<div class="message message-from">
				<div class="message-name">
					<h1>音声サポート</h1>
				</div>
				<div class="message-body">
					<p>
						CHROME 対応　マイクを用意してください.
					</p>
				</div>
				<div class="message-timestamp">
					<p>Today 10:02</p>
				</div>
			</div>
			<div class="message message-to">
				<div class="message-name">
					<h1>You</h1>
				</div>
				<div class="message-body">
					<p>
						こんにちは　音声ナビ　へ　業務フローと連動して作業をナビゲートします.
					</p>
				</div>
				<div class="message-timestamp">
					<p>Today 10:14</p>
				</div>
			</div>
			<div class="message message-from">
				<div class="message-name">
					<h1>BPMCHAT</h1>
				</div>
				<div class="message-body">
					<p>
						音声、または　テキストに業務項目を登録するとナビゲートが始まります　説明はこちら
					</p><a href="https://bpmchat.com" target="_blunk">BPMCHAT説明</a>
				</div>
				<div class="message-timestamp">
					<p>Today 10:20</p>
				</div>
			</div>
		</div>
		<div class="message-input-bar">
			<div id="media-expand-arrow" class="media-expand-arrow">
				<div class="media-expand-arrow-line media-expand-arrow-line-1"></div>
				<div class="media-expand-arrow-line media-expand-arrow-line-2"></div>
				<div class="media-expand-arrow-line media-expand-arrow-line-3"></div>
			</div>
			<div class="message-text-input">
				<form class="message-send">
					<textarea id="message-input" placeholder="ｗｗｗMessage..." value=""></textarea>
					<textarea id="status" placeholder="Message..." value=""></textarea>

				</form>
			</div>
		</div>
		<div id="media-bar" class="media-bar">
			<div class="media-bar-header">
				<div class="media-bar-title">
					<h1>Media</h1>
				</div>
				<div id="media-bar-cross" class="media-close">
					<div class="media-close-line media-close-line-1"></div>
					<div class="media-close-line media-close-line-2"></div>
				</div>
			</div>
			<div class="media-bar-body">
				<div class="media-buttons-canvas">
					<div class="media-button media-video">
						<img src="https://imgur.com/x9NDjYV.png">
					</div>
					<div class="media-button media-image">
						<img src="https://imgur.com/0Sw4F6i.png">
					</div>
					<div class="media-button media-audio">
						<img src="https://imgur.com/2KlzOiN.png">
					</div>
					<div class="media-button media-location">
						<img src="https://imgur.com/OvqVDk5.png">
					</div>
				</div>
			</div>
		</div>

	<script>
		/*
This is an example snippet - you should consider tailoring it
to your service.
*/

		/*
		This is an example snippet - you should consider tailoring it
		to your service.
		*/

		async function fetchGraphQL(operationsDoc, operationName, variables) {
			const result = await fetch(
				"https://showcase.dreamso.net/v1/graphql",
				{
					method: "POST",
					body: JSON.stringify({
						query: operationsDoc,
						variables: variables,
						operationName: operationName
					})
				}
			);

			return await result.json();
		}

		const operationsDoc = `
  query MyQuery {
    Address {
      address
      Address_id
    }
  }
`;

		function fetchMyQuery() {
			return fetchGraphQL(
				operationsDoc,
				"MyQuery",
				{}
			);
		}

		async function startFetchMyQuery() {
			const { errors, data } = await fetchMyQuery();

			if (errors) {
				// handle those errors like a pro
				console.error(errors);
			}

			// do something great with this precious data
			//データ内容の表示
			console.log("graphql connect")
			console.debug(JSON.stringify(data))
			console.log(data);
		}

		startFetchMyQuery();


		var config = {
			apiKey: "AIzaSyCsOjFyAAuFr1CITcnufG-GpZBKpLgUP90",
			authDomain: "rpa999-56929.firebaseapp.com",
			databaseURL: "https://rpa999-56929.firebaseio.com",
			projectId: "rpa999-56929",
			storageBucket: "rpa999-56929.appspot.com",
			messagingSenderId: "155298248089",
			appId: "1:155298248089:web:e25d64dc9f5370c4"
		};

		firebase.initializeApp(config);

		// データベースの参照を準備
		var messagesRef = firebase.database().ref().child('messages')
		var messageFeed = document.getElementById("message-feed");


		messagesRef.on('child_changed', function (data) {
			//alert("data changed")
			//  alert(data.key)
			//alert(JSON.stringify(data.val()));
			var msg = data.val();
			//alert(msg.name)
			//alert(msg.body)
			var lg = JSON.stringify(msg)
			//alert(lg)
			//     var msg = snapshot.val();
			//           $('<li>').text(""+msg.name + ': ' + msg.body).prependTo('#messages');
			//        $('#message-feed').append('<div class="message message-from"><div class="message-name"><h1>BPMCHAT success 272 </h1></div><div class="message-body"><p><h3>' + msg.name + ': ' + msg.body+ '</h3><p>Today</p></div>');
			//    messageFeed.scrollTop = messageFeed.scrollHeight;
			//          timedResponse();
			//location.reload()
			//alert(lg)
			//  alert(lg)
			//setCommentValues(postElement, data.key, data.val().text, data.val().author);
			//       $('#message-feed').append('<div class="message message-from"><div class="message-name"><h1>BPMCHAT success 272 </h1></div><div class="message-body"><p><h3>' + msg.name + ': ' + msg.body + '</h3><p>Today</p></div>');
			//     $('#message-feed').append('<div class="message message-from"><div class="message-name"><h1>BPMCHAT success 272 </h1></div><div class="message-body"><p><h3>ｓ' + msg.name + ': ' + msg.body + '</h3><p>Today</p></div>');

			//   timedResponse();
		});



		// 既存メッセージを表示
		messagesRef.on('child_added', function (snapshot) {
			startFetchMyQuery();
			var msg = snapshot.val();
			//alert(JSON.stringify(msg))
			$('<li>').text("" + msg.name + ': ' + msg.text).prependTo('#messages');
			$('#message-feed').append('<div class="message message-from"><div class="message-name"><h1>BPMCHAT success 272 </h1></div><div class="message-body"><p><h3>' + msg.name + ': ' + msg.text + '</h3><p>Today</p></div>');
			messageFeed.scrollTop = messageFeed.scrollHeight;
			timedResponse();

		});

/*
		$('#message-input').click(function () {
			//window.top.document.getElementsByClassName("script-application-sidebar")[0].style.width = '100px';
			// 新規メッセージを投稿
			var messagesRef = firebase.database().ref().child('messages')
			messagesRef.push({
				name: $('#message-input').val(),
				text: $('#message-input').val()
			});
			//alert($('#message').val())

			google.script.run.execGAS(1, $('#message').val())
		});
*/		
/*
		var main_layout = new dhtmlXLayoutObject(document.body, '1C');
		var a = main_layout.cells('a');
		var toolbar_1 = a.attachToolbar();
		toolbar_1.setIconsPath('https://dhtmlx.com/docs/products/visualDesigner/live/preview/codebase/imgs/');
		var obj2 =

			toolbar_1.loadStruct('https://dhtmlx.com/docs/products/visualDesigner/live/preview/data/toolbar.xml', function () { });
		var objidbot = document.getElementById("chatobj");
		a.attachObject(objidbot);
		*/
	</script>

</body>

</html>